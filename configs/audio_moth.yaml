# configs/audio_moth.yaml

seed: 42

paths:
  data_root: data
  cache_root: data_cache
  runs_root: runs

audio:
  sample_rate: 16000
  bandpass: [100, 3000]
  segment_sec: 1.0
  segment_hop: 0.5
  silence_dbfs: -40

features:
  type: logmel
  n_mels: 64
  n_fft: 1024
  win_ms: 25
  hop_ms: 10
  cmvn: true

train:
  batch_size: 64
  epochs: 40
  lr: 0.001
  weight_decay: 0.0
  optimizer: adam
  num_workers: 0
  val_every: 1

  # ✅ Make early exits stronger (important for EA depth~1.3)
  # Old: [0.3, 0.3, 1.0]
  loss_weights: [1.0, 0.5, 0.2]

  # ✅ Knowledge Distillation: exit3 teaches exit1/exit2
  kd:
    enable: true
    alpha: 0.6     # strength of KD term (0.4–0.8 typical)
    temp: 2.0      # distillation temperature
    weights: [1.0, 0.7]   # [exit1, exit2] -> distill exit1 more

  # ✅ SpecAugment for robustness (train only)
  specaug:
    enable: true
    freq_mask: 8
    time_mask: 12
    num_masks: 2

model:
  num_classes: 2
  exits: 3

calibration:
  temperature_scaling: true

thresholds:
  strategy: f1_under_budget
  compute_budget_ms: 4.0
  grid_tau: [0.70, 0.75, 0.80, 0.85, 0.90, 0.92, 0.95]
  grid_alpha: [0.10, 0.08, 0.05, 0.03, 0.02]

ea:
  enabled: true
  mode: logprob
  threshold_grid: [0.05, 0.10, 0.15, 0.20, 0.25, 0.30]
  min_exit: 0
  stable_k: 1
  flip_penalty: 0.0

split:
  train: 0.7
  val: 0.15
  test: 0.15
  stratify: true
